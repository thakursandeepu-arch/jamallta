<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Clients / Studios - Jamallta Films</title>

<!-- Bootstrap (for modal) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

<!-- Local CSS (keep after Bootstrap to override defaults) -->
<link href="./assets/clients.css" rel="stylesheet"/>
</head>

<body>

<div class="container-root">

<!-- ================= CLIENT LIST ================= -->
<div id="clientListSection">

  <!-- TOP BAR -->
  <div class="flex-row" style="margin-bottom:12px;">
    <input class="search-input" id="clientSearch" placeholder="Search studios / phone / city"/>
    <button class="btn-square btn-primary-style" id="btnAddClient">+ Add Client</button>
    <button class="btn-square btn-ghost" id="btnSyncAuthClients">Sync Auth Users</button>
  </div>

  <!-- CLIENTS TABLE -->
  <div class="panel table-card">
    <table class="table-auto clients-table">
      <thead>
        <tr>
          <th>Studio</th>
          <th>Phone</th>
          <th>City</th>
          <th>Address</th>
          <th>Total Balance</th>
        </tr>
      </thead>
      <tbody id="clientsTableBody"></tbody>
    </table>
  </div>

</div>

<!-- ================= PROFILE ================= -->
<div class="hidden" id="profileSection">

  <div class="flex-row" style="margin-bottom:12px;">
    <button class="btn-square btn-muted" id="btnBackToList">Back</button>

    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn-square btn-primary-style" id="btnEditCustomer">Edit</button>
      <button class="btn-square" id="btnDeleteCustomer" style="background:#c0392b;color:#fff;">Delete</button>
      <button class="btn-square btn-ghost" id="btnProfilePdf">Export Profile PDF</button>
    </div>
  </div>

  <div class="panel panel-dark" id="profilePanel">

    <div class="profile-grid">
      <div>
        <label class="small-muted">Studio Name</label>
        <input class="form-control" id="studioNameInput" readonly/>
      </div>
      <div>
        <label class="small-muted">Phone</label>
        <input class="form-control" id="phoneInput" readonly/>
      </div>
      <div>
        <label class="small-muted">City</label>
        <input class="form-control" id="cityInput" readonly/>
      </div>
      <div>
        <label class="small-muted">Address</label>
        <input class="form-control" id="addressInput" readonly/>
      </div>
      <div>
        <label class="small-muted">Email (Gmail)</label>
        <input class="form-control" id="emailInput" readonly/>
      </div>
    </div>

    <div class="balance-box">
      <div><b>Current Balance:</b> Rs <span id="liveBalance">0</span></div>
      <div class="text-success small-muted" id="advanceInfo" style="display:none">
        Advance: Rs <span id="advanceAmount">0</span>
      </div>
      <div class="small-muted">Last Updated: <span id="lastUpdated">-</span></div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;">
      <button class="btn-square btn-primary-style" id="btnAddPayment">Add Payment</button>
      <button class="btn-square btn-muted" id="btnAddItems">Add / Edit Items</button>
    </div>

  </div>

  <!-- JOBS -->
  <div class="panel table-card" style="margin-top:14px">
    <div class="flex-row">
      <b>All Projects / Jobs</b>
      <div class="jobs-toolbar">
        <div class="job-filter-bar" id="jobFilters">
          <div class="job-filter-left">
            <button class="job-filter active" data-filter="total">Total Jobs <span id="jobCountTotal">0</span></button>
            <button class="job-filter" data-filter="paid">Paid Jobs <span id="jobCountPaid">0</span></button>
            <button class="job-filter" data-filter="unpaid">Unpaid Jobs <span id="jobCountUnpaid">0</span></button>
            <button class="job-filter" data-filter="ready">Ready Jobs <span id="jobCountReady">0</span></button>
            <button class="job-filter" data-filter="processing">Processing <span id="jobCountProcessing">0</span></button>
            <button class="job-filter" data-filter="pending">Pending Jobs <span id="jobCountPending">0</span></button>
          </div>
          <div class="job-filter-right">
            <button class="job-filter-range active" data-range="month">This Month</button>
            <button class="job-filter-range" data-range="all">All Time</button>
          </div>
        </div>
        <div class="job-search-wrap">
          <input class="search-input" id="jobSearch" placeholder="Search jobs by no / project / editor"/>
          <div class="small-muted" id="jobsCount">Loading...</div>
        </div>
      </div>
    </div>

    <table class="table-auto jobs-table">
      <thead>
        <tr>
          <th>Job No</th>
          <th>Project</th>
          <th>Date</th>
          <th>Editor</th>
          <th>Total</th>
          <th>Paid</th>
          <th>Pending</th>
          <th>Payment</th>
          <th>Status</th>
          <th>Ready</th>
          <th>Deliver</th>
          <th>Deleted At</th>
        </tr>
      </thead>
      <tbody id="jobsList"></tbody>
    </table>
  </div>

  <!-- PAYMENTS -->
  <div class="panel table-card" style="margin-top:14px">
    <div class="flex-row">
      <b>Payment Transactions</b>
      <div class="small-muted" id="paymentsCount">Loading payments...</div>
    </div>

    <table class="table-auto payments-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Amount</th>
          <th>Remarks</th>
        </tr>
      </thead>
      <tbody id="paymentsList">
        <tr>
          <td colspan="3" style="text-align:center;padding:20px">No payments</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>
</div>

<!-- ================= TOAST ================= -->
<div class="toast" id="toast"><span id="toastMessage"></span></div>

<!-- ================= PROFILE PDF MODAL ================= -->
<div class="modal fade" id="profilePdfModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-dark">
      <div class="modal-header">
        <h5 class="modal-title">Export Profile PDF</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label class="small-muted" for="pdfClientSelect">Client</label>
        <select class="form-control" id="pdfClientSelect"></select>
        <div style="height:10px"></div>
        <label class="small-muted" for="pdfFromDate">From Date</label>
        <input class="form-control" type="date" id="pdfFromDate"/>
        <div style="height:10px"></div>
        <label class="small-muted" for="pdfToDate">To Date</label>
        <input class="form-control" type="date" id="pdfToDate"/>
        <div style="height:10px"></div>
        <label class="small-muted">Payment Filter</label>
        <div class="form-control" style="height:auto;padding:10px">
          <label style="display:flex;gap:8px;align-items:center;margin:0 0 6px 0;">
            <input type="checkbox" id="pdfPayUnpaid" checked /> Unpaid
          </label>
          <label style="display:flex;gap:8px;align-items:center;margin:0 0 6px 0;">
            <input type="checkbox" id="pdfPayPartial" checked /> Partial Paid
          </label>
          <label style="display:flex;gap:8px;align-items:center;margin:0;">
            <input type="checkbox" id="pdfPayFully" /> Fully Paid
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="exportProfilePdfConfirm">Export</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- ================= PDF PREVIEW MODAL ================= -->
<div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content modal-dark">
      <div class="modal-header">
        <h5 class="modal-title">PDF Preview</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="height:70vh;">
        <iframe id="pdfPreviewFrame" title="PDF Preview" style="width:100%;height:100%;border:none;border-radius:12px;"></iframe>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="pdfPreviewDownload">Download PDF</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- ================= JOB DETAIL MODAL ================= -->
<div class="modal fade" id="jobDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content modal-dark">
      <div class="modal-header">
        <h5 class="modal-title">Job Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="jobDetailBody"></div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="deleteJobBtn">Delete</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- ================= PAYMENT MODAL (NEW) ================= -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-dark">
      <div class="modal-header">
        <h5 class="modal-title">Add Payment</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label class="small-muted" for="paymentAmount">Amount (₹)</label>
        <input class="form-control" type="number" step="0.01" id="paymentAmount" placeholder="Enter amount"/>
        <div style="height:10px"></div>
        <label class="small-muted" for="paymentNote">Remarks</label>
        <input class="form-control" type="text" id="paymentNote" placeholder="Payment received"/>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="savePaymentBtn">Save Payment</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- ================= ITEMS MODAL (NEW) ================= -->
<div class="modal fade" id="itemsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content modal-dark">
      <div class="modal-header">
        <h5 class="modal-title">Studio Items - <span id="itemsStudioName"></span></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="flex-row" style="margin-bottom:12px;">
          <div><b>Add or edit items for this studio</b></div>
          <button class="btn-square btn-muted" id="addItemRowBtn">+ Add Row</button>
        </div>
        <table class="table-auto" style="width:100%">
          <thead>
            <tr>
              <th style="text-align:left;padding:8px">Item Name</th>
              <th style="text-align:left;padding:8px">Qty / Time</th>
              <th style="text-align:left;padding:8px">Price</th>
              <th style="text-align:left;padding:8px">Action</th>
            </tr>
          </thead>
          <tbody id="itemsTableBody"></tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="saveItemsBtn">Save Items</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- ================= MODALS & SCRIPTS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script type="module" src="./assets/clients.js"></script>

</body>
</html>
